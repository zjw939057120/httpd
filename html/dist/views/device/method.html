<title>监听单元格事件 - 数据表格</title>

<div class="layui-card layadmin-header">
  <div class="layui-breadcrumb" lay-filter="breadcrumb">
    <a lay-href="">主页</a>
    <a><cite>组件</cite></a>
    <a><cite>数据表格</cite></a>
    <a><cite>监听单元格事件</cite></a>
  </div>
</div>

<div class="layui-fluid">
  <div class="layui-row layui-col-space15">

    <div class="layui-form layui-card-header layuiadmin-card-header-auto" lay-filter="layadmin-userfront-formlist">
      <div class="layui-form-item">
        <div class="layui-inline">
          <label class="layui-form-label">方法列表</label>
          <div class="layui-input-block">
            <select name="method_list" id="method_list" lay-filter="method_list">
              <option value="">未选择</option>
              <!-- 这里的选项会通过 AJAX 动态填充 -->
            </select>
          </div>
        </div>

        <div class="layui-inline">
          <label class="layui-form-label">方法类型</label>
          <div class="layui-input-block">
            <select name="type" id="type" lay-filter="type">
              <option value="">未选择</option>
              <option value="0">单硫</option>
              <option value="1">单氮</option>
              <option value="2">单氯</option>
              <option value="3">硫氮</option>
              <option value="4">CELL</option>
              <option value="5">待机</option>
              <option value="6">启动</option>
            </select>
          </div>
        </div>
        <div class="layui-inline">
          <label class="layui-form-label">进样器类型</label>
          <div class="layui-input-block">
            <select name="injector_type" id="injector_type" lay-filter="injector_type">
              <option value="">未选择</option>
              <option value="0">AJ</option>
              <option value="1">液体</option>
              <option value="2">气体</option>
              <option value="3">固体</option>
              <option value="4">无</option>
            </select>
          </div>
        </div>

        <div class="layui-inline">
          <label class="layui-form-label">样品类型</label>
          <div class="layui-input-block">
            <select name="sample_type" id="sample_type" lay-filter="sample_type">
              <option value="">未选择</option>
              <option value="0">液体</option>
              <option value="1">气体</option>
              <option value="2">固体</option>
            </select>
          </div>
        </div>

        <div class="layui-inline">
          <label class="layui-form-label">方法名称</label>
          <div class="layui-input-block">
            <input type="text" name="name" id="name" placeholder="请输入" autocomplete="off" class="layui-input">
          </div>
        </div>

      </div>
    </div>

    <div class="layui-col-md4">
      <div class="layui-card">
        <div class="layui-card-header">温度设置</div>
        <div class="layui-card-body">

          <table class="layui-hide" id="method_temp" lay-filter="method_temp"></table>
        </div>
      </div>
    </div>

    <div class="layui-col-md4">
      <div class="layui-card">
        <div class="layui-card-header">压力设置</div>
        <div class="layui-card-body">

          <table class="layui-hide" id="method_pass" lay-filter="method_pass"></table>
        </div>
      </div>
    </div>
    <div class="layui-col-md4">
      <div class="layui-card">
        <div class="layui-card-header">流量设置</div>
        <div class="layui-card-body">

          <table class="layui-hide" id="method_flow" lay-filter="method_flow"></table>
        </div>
      </div>
    </div>
    <div class="layui-col-md4">
      <div class="layui-card">
        <div class="layui-card-header">其他设置</div>
        <div class="layui-card-body">

          <table class="layui-hide" id="method_other" lay-filter="method_other"></table>
        </div>
      </div>
    </div>
    <div class="layui-col-md4">
      <div class="layui-card">
        <div class="layui-card-header">进样器设置</div>
        <div class="layui-card-body">

          <table class="layui-hide" id="method_injector" lay-filter="method_injector"></table>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
  layui.use(['admin', 'form', 'table'], function () {
    var $ = layui.$
      , admin = layui.admin
      , element = layui.element
      , form = layui.form
      , table = layui.table;

    var method_list = {};

    // [方法列表]动态填充数据后需要重新渲染 select
    $.ajax({
      url: '/api/method_list/get_all', // 替换为你的 JSON 接口地址
      method: 'GET',
      success: function (res) {
        method_list = res.data; // 将数据存储到全局变量中
        // 假设返回的数据格式为：[{ "id": "1", "name": "方法1" }, { "id": "2", "name": "方法2" }]
        var options = '<option value="">未选择</option>';
        method_list.forEach(function (item) {
          options += '<option value="' + item.id + '">' + item.name + '</option>';
        });
        $('#method_list').html(options); // 填充到 select 中
        form.render('select'); // 重新渲染表单
      },
      error: function () {
        console.error('请求失败');
      }
    });


    // 监听[方法列表]改变事件
    form.on('select(method_list)', function (data) {
      if (!data.value) return; // 防止未选择时触发
      console.log('选中的值:', data.value); // 获取选中的值

      $('#type').val(method_list[data.value].type); // 设置选中值
      $('#injector_type').val(method_list[data.value].injector_type); // 设置选中值
      $('#sample_type').val(method_list[data.value].sample_type); // 设置选中值
      $('#name').val(method_list[data.value].name);
      form.render('select'); // 重新渲染 select
    });






    function renderMethodTemp(type) {

    }




    form.render(null, 'layadmin-userfront-formlist');

    table.render({
      elem: '#method_temp'
      , minheight: 313
      , url: './json/table/user.js'
      , cols: [[
        , { field: 'username', title: '用户名' }
        , { field: 'sign', title: '签名', event: 'setSign', style: 'cursor: pointer;' }
      ]]
    });
    table.render({
      elem: '#method_pass'
      , minheight: 313
      , url: './json/table/user.js'
      , cols: [[
        , { field: 'username', title: '用户名' }
        , { field: 'sign', title: '签名', event: 'setSign', style: 'cursor: pointer;' }
      ]]
    });
    table.render({
      elem: '#method_flow'
      , minheight: 313
      , url: './json/table/user.js'
      , cols: [[
        , { field: 'username', title: '用户名' }
        , { field: 'sign', title: '签名', event: 'setSign', style: 'cursor: pointer;' }
      ]]
    });
    table.render({
      elem: '#method_other'
      , minminheight: 313
      , url: './json/table/user.js'
      , cols: [[
        , { field: 'username', title: '用户名' }
        , { field: 'sign', title: '签名', event: 'setSign', style: 'cursor: pointer;' }
      ]]
    });
    table.render({
      elem: '#method_injector'
      , minheight: 313
      , url: './json/table/user.js'
      , cols: [[
        , { field: 'username', title: '用户名' }
        , { field: 'sign', title: '签名', event: 'setSign', style: 'cursor: pointer;' }
      ]]
    });

    //监听单元格事件
    table.on('tool(method_temp)', function (obj) {
      var data = obj.data;
      if (obj.event === 'setSign') {
        layer.prompt({
          formType: 2
          , title: '修改 ID 为 [' + data.id + '] 的用户签名'
          , value: data.sign
        }, function (value, index) {
          layer.close(index);

          //这里一般是发送修改的Ajax请求

          //同步更新表格和缓存对应的值
          obj.update({
            sign: value
          });
        });
      }
    });

  });
</script>

<style>
  /* 设置 #method_temp 列宽度 */
  #method_temp+.layui-table-view th:nth-child(1),
  #method_temp+.layui-table-view td:nth-child(1) {
    width: 60% !important;
    /* 第一列宽度 60% */
  }

  #method_temp+.layui-table-view th:nth-child(2),
  #method_temp+.layui-table-view td:nth-child(2) {
    width: 40% !important;
    /* 第二列宽度 40% */
  }

  /* 设置 #method_pass 列宽度 */
  #method_pass+.layui-table-view th:nth-child(1),
  #method_pass+.layui-table-view td:nth-child(1) {
    width: 60% !important;
    /* 第一列宽度 60% */
  }

  #method_pass+.layui-table-view th:nth-child(2),
  #method_pass+.layui-table-view td:nth-child(2) {
    width: 40% !important;
    /* 第二列宽度 40% */
  }

  /* 设置 #method_flow 列宽度 */
  #method_flow+.layui-table-view th:nth-child(1),
  #method_flow+.layui-table-view td:nth-child(1) {
    width: 60% !important;
    /* 第一列宽度 60% */
  }

  #method_flow+.layui-table-view th:nth-child(2),
  #method_flow+.layui-table-view td:nth-child(2) {
    width: 40% !important;
    /* 第二列宽度 40% */
  }

  /* 设置 #method_other 列宽度 */
  #method_other+.layui-table-view th:nth-child(1),
  #method_other+.layui-table-view td:nth-child(1) {
    width: 60% !important;
    /* 第一列宽度 60% */
  }

  #method_other+.layui-table-view th:nth-child(2),
  #method_other+.layui-table-view td:nth-child(2) {
    width: 40% !important;
    /* 第二列宽度 40% */
  }

  /* 设置 #method_injector 列宽度 */
  #method_injector+.layui-table-view th:nth-child(1),
  #method_injector+.layui-table-view td:nth-child(1) {
    width: 60% !important;
    /* 第一列宽度 60% */
  }

  #method_injector+.layui-table-view th:nth-child(2),
  #method_injector+.layui-table-view td:nth-child(2) {
    width: 40% !important;
    /* 第二列宽度 40% */
  }
</style>